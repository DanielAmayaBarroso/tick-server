(function($, _, Backbone, SpecialK) {

    Backbone.Bindings = function(view) {
        view.$el.on('change keyup DOMSubtreeModified', '[data-binding]', function() {

            var key, value, ctx = {};
            ctx.$el= $(this);
            ctx.key = ctx.$el.data('binding');
            ctx.value = view.model.get(ctx.key) || '';
            ctx.previusValue = ctx.value;
            ctx.view = view;
            value = SpecialK.modifiers.run(ctx);

            // aplicar modifiers y value
            value = SpecialK.modifiers.normalizeValue(ctx);
            key   = SpecialK.modifiers.normalizeKey(ctx);

            // save
            view.model.set(key, value);
        });
    };


})(jQuery, window._, window.Backbone, window.SpecialK);

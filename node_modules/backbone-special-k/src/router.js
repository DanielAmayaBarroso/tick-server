(function(Backbone, SpecialK, bootbox) {

    Backbone.BaseRouter = Backbone.Router.extend({

        _routes: {},

        constructor: function() {
            if (this.routeStartPoint) {
                this.routes = {};
                this.routes[this.routeStartPoint] = 'list';
                this.routes[this.routeStartPoint + '/add'] = 'form';
                this.routes[this.routeStartPoint + '/edit/:id'] = 'edit';
            }
            Backbone.Router.prototype.constructor.apply(this, arguments);
        },

        cache: false,
        modelFetchData: {},
        editIdNumberInUrl: 1,

        initialize: function() {
            if (this.init) this.init();
        },

        list: function () {
            SpecialK.ViewManager.mount(new this.ListView());
        },

        form: function(model) {
            var options = {};
            if (typeof model === 'object') {
                options = {model: model};
            }
            SpecialK.ViewManager.mount(new this.FormView(options));
        },

        edit: function () {
            var id = arguments[this.editIdNumberInUrl - 1];
            var model;
            var that = this;

            if (this.listView) {
                model = this.listView.collection.get(id);
                if (model) {
                    return this.form(model);
                }
            }

            model = new this.Model();
            model.set('_id', id);
            model.fetch({
                data: this.modelFetchData,
                cache: this.cache,
                success: function(model) {
                    that.form(model);
                },
                error: function() {
                    bootbox.alert('Error al cargar model de ' + that.routeStartPoint);
                }
            });
        }
    });

})(Backbone, SpecialK, bootbox);

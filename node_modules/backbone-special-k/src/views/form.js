(function(Backbone, SpecialK) {

    Backbone.FormView = Backbone.View.extend({
        tagName: 'div',
        classname: 'form-view',
        Model: null,

        events: {}, // user defined events
        _events: { // SpecialK default events
            'click .btn-save': 'save'
        },

        constructor: function() {
            var that = this;

            _.forOwn(this._events, function(action, event) {
                that.events[event] = action;
            });

            Backbone.View.prototype.constructor.apply(this, arguments);
        },

        initialize: function() {
            if (!this.model) {
                this.model = new this.Model();
            }

            if (this.init) this.init.apply(this, arguments);
        },

        render: function() {
            this.renderData = this.model.toJSON() || {};

            if (this.beforeRender) this.beforeRender.apply(this, arguments);
            this.$el.html(this.template(this.renderData));
            if (this.onRender) this.onRender.apply(this, arguments);

            Backbone.Bindings(this);

            return this;
        },

        save: function() {
            this.model.save(null, {
                success: function() {
                    console.log('success');
                },
                error: function(err) {
                    SpecialK.error(err);
                }
            });
        }
    });

})(Backbone, SpecialK);
